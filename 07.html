<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"></meta>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Блог Стебунова Владимира</title>
		<link rel="stylesheet" type="text/css" href="main.css">	
        <meta property="og:title" content="Синий шум и стиплинг" />
		<meta property="og:image" content="http://vstebunov.me/img/og_image2.jpg" />
	</head>
	<body>
		<header>
            <h1><a href="/">Блог Стебунова Владимира</a></h1>
		</header>
		<main>
			<article>
				<time datetime=26-07-2017>14 июля 2017</time>
				<h1>Синий шум</h1>

<h3>Рандомизированный дитеринг и белый шум.</h3>

<p>Существует еще один диттеринг, который обычно не применяется - рандомизированный. Мы генерируем шум размером с исходное изображение, содержащее в каждой клетке число от 0 до 255. Затем проходимся по изображению, выбирая яркость пикселя в той же размерности от 0 до 255. Если яркость пикселя больше случайной величины, то ставим черный пиксель, иначе - белый пиксель. Изображение получается не очень. Вот пример.</p>

<p><img src="img/rd_sample1.jpg" alt="Изображение1" /></p>

<h3>Синий шум</h3>

<p>Для того чтобы изображение получалось не таким замусоренным, можно использовать синий шум. Синий шум обладает другими свойствами распределения точек. Он ближе к <a href="">распределению сетчатки в глазном яблоке</a>. В компьютерной графике термин «синий шум» часто используется для обозначения любого шума с минимальными низкими частотой компонентов и равномерной мощностью (без концентрированных пиков энергии). Это значит, что у нас нет структурных наложений (точки не стоят близко) из-за низкой частоты. И есть равные промежутки между этими структурами. Для генерации синего шума применяется много методов. Все методы, которые мне встречались, не генерируют бесконечную маску. Необходимо задавать размеры получаемой маски. Я воспользовался <a href="https://www.solidangle.com/research/dither_abstract.pdf">этим методом</a> для генерации пиксельной маски с синим шумом. Смысл метода прост. Мы генерируем маску определенного размера с белым шумом. Затем мы считаем энергетическую функцию полученной маски. Переставляем случайным образом два пикселя. Далее вычисляем вероятность того, что эта перестановка останется. И бросаем кубик с этой вероятностью. Сохраняем состояние, если кубик сказал нам так сделать. Повторяем этот цикл, пока &quot;температура&quot; не упадёт или не найдем удовлетворяющий результат. Это называется симуляция отжига.</p>

<h3>Проблемы генерации синего шума.</h3>

<p>Алгоритмы генерации синего шума не очень быстрые, имеют ограничения на размер и зависят от экспериментально выбранных параметров, чтобы получить интересный результат. Многое зависит от &quot;температуры&quot;. Я не нашел корректной процедуры правильного выбора начальной температуры. А сама начальная температура даёт очень разный результат в итоге.</p>

<h3>Примеры диттеринга</h3>

<p><img src="img/bn_sample1.png" alt="Изображение2" /></p>

<h3>Стипплинг</h3>

<p><img src="img/circles20.png" alt="Картинка в горошек" /></p>

<p>Кроме того, синий шум прекрасно подходит для имитации <a href="https://en.wikipedia.org/wiki/Stippling">стиплинга.</a> Стиплинг - это способ рисования, в котором полутени и закрашивание делаются с помощью точек. Чем ближе находятся точки, тем темнее этот участок. Изобретение приписывают <a href="https://en.wikipedia.org/wiki/Giulio_Campagnola">Джулио Кампаньоле - средневековому граверу.</a> Для реализации стиплинга я буду использовать алгоритм из <a href="http://www.cs.virginia.edu/~gfx/pubs/antimony/antimony.pdf">этой статьи</a>. Размер диска пуассона будет возрастать с яркостью участка изображения для получения разности в штриховке.</p>

<p>Алгоритм следующий:</p>

<ol>
<li>Ставим первую точку в любом месте.</li>
<li>В ее окрестность в виде кольца ставим новую точку.</li>
<li>Теперь вычитаем пересечения этих окрестностей, в них мы уже не можем поставить точки.</li>
<li>Для простоты мы просто вычитаем углы, в которые невозможно поставить точку.</li>
<li>Ставим её.</li>
<li>У новой точки находим свободные углы и ставим на их место точки.</li>
<li>Повторяем. </li>
</ol>

<p>Вот как это работает на этой гифке.</p>

<p><img src="img/stippling.gif" alt="Stippling" /></p>

<p>Самым сложным в реализации оказалось вычитать углы. Нечасто работаешь с кругами, надо помнить что углы надо нормализовать, чтобы они были положительными и не выходили за радиус. Я так и не нашёл специальных структур, работающих с полярными координатами, и довольствовался простым списком и алгоритмами нормализации.</p>

<h3>Примеры</h3>

<p>Градиент. Радиус 2 пикселя.</p>

<p><img src="img/circles5959731.5.png" alt="Градиент. Радиус 2 пикселя." /></p>

<p>Красная жара. Радиус 0.5 пикселя. Количество точек 45759</p>

<p><img src="img/circles6805886.5size45759.png" alt="Красная жара. Радиус 0.5 пикселя. Количество точек 45759" /></p>

<p>Лена. Радиус 2 пикселя. Количество точек 59225</p>

<p><img src="img/circles5318859.0size59225.png" alt="Лена. Радиус 2 пикселя. Количество точек 59225" /></p>

<p>Лена. Радиус 0.5 пикселя. Количество точек 54794</p>

<p><img src="img/circles4880559.5size54794.png" alt="Лена. Радиус 1 пиксель. Количество точек 54794" /></p>

<p>Красная жара. Радиус 1 пиксель. Количество точек 88776</p>

<p><img src="img/circles2988260.5size88776.png" alt="Красная жара. Радиус 1 пиксель. Количество точек 88776" /></p>

<h3>Ссылки</h3>

<ul>
<li><a href="http://www.joesfer.com/?p=108">Основная запись с которой всё началось + нормальное определение синего шума</a></li>
<li><a href="http://weber.itn.liu.se/~sasgo26/Digital_Halftoning/Halftoning_Papers/BlueNoiseMask(ny).pdf">Вот здесь прикольный график с качеством диттеринга</a></li>
<li><a href="http://www.sprouls.com/blog/2012/11/stipple-illustrations-visual-learners/">Реклама стипплинга с иллюстрациями</a></li>
<li><a href="http://www.cs.virginia.edu/~gfx/pubs/antimony/CS-2006-08.pdf">Cтатья с алгоритмом стиплинга</a></li>
</ul>
			</article>
			<p>
                <a href="08.html">Следующая статья</a>
			</p>
			<p>
                <a href="06.html">Предыдущая статья</a>
			</p>
		</main>
		<hr/>
		<footer>
			<p>Любая перепечатка материалов возможна только с разрешения владельца сайта</p>
		</footer>
	</body>
</html>
